"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PluginMiddleware = void 0;
const Middleware_1 = require("../lib/structures/Middleware");
class PluginMiddleware extends Middleware_1.Middleware {
    constructor(context) {
        super(context, { position: 40 });
        Object.defineProperty(this, "cookieName", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        const { server } = this.container;
        this.cookieName = server.auth?.cookie ?? 'SAPPHIRE_AUTH';
        this.enabled = server.auth !== null;
    }
    run(request, response) {
        // If there are no cookies, set auth as null:
        const authorization = response.cookies.get(this.cookieName);
        if (!authorization) {
            request.auth = null;
            return;
        }
        // Decrypt the cookie, and if the token is invalid, remove the cookie:
        request.auth = this.container.server.auth.decrypt(authorization);
        if (request.auth === null)
            response.cookies.remove(this.cookieName);
    }
}
exports.PluginMiddleware = PluginMiddleware;
//# sourceMappingURL=auth.js.map